"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[277],{2277:function(e,t,a){a.r(t),a.d(t,{default:function(){return L}});var s=a(5893),n=a(7294),c=a(6784),o=a.n(c),l=a(1485),r=a(8751),i=e=>{let{isOpen:t,onRestart:a}=e;return(0,s.jsx)("div",{className:"".concat(o().modal," ").concat(t?o().modalShow:""),children:(0,s.jsxs)("div",{className:o().modalContent,children:[(0,s.jsx)("h2",{children:"Game Over!"}),(0,s.jsx)("p",{children:"You've lost all your pickaxes!"}),(0,s.jsx)("button",{className:o().restartBtn,onClick:a,children:"Play Again"})]})})},d=a(2627);class u{createAudioContext(){let e=window.AudioContext||window.webkitAudioContext;if(!e)return console.warn("Web Audio API is not supported in this browser"),null;try{return new e}catch(e){return console.warn("Failed to create audio context:",e),null}}initialize(){if(this.initialized)return!0;try{if(this.audioContext=this.createAudioContext(),!this.audioContext)return console.warn("Could not create audio context, sound will be disabled"),this.enabled=!1,!1;return this.initialized=!0,this.preloadSounds(["default","stone","iron","diamond"]),!0}catch(e){return console.warn("Sound initialization failed, disabling sounds:",e),this.enabled=!1,!1}}setEnabled(e){this.enabled=e}preloadSounds(e){this.enabled&&this.audioContext&&e.forEach(e=>{let t=this.getSoundFileForBlockType(e);this.loadSound(t).then(t=>{this.soundBuffers[e]=t}).catch(t=>{console.warn("Failed to load sound for ".concat(e,":"),t)})})}async loadSound(e){if(!this.enabled||!this.audioContext)return null;try{let t=await fetch(e);if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));let a=await t.arrayBuffer();return new Promise((e,t)=>{try{2===this.audioContext.decodeAudioData.length?this.audioContext.decodeAudioData(a,t=>e(t),e=>t(e||Error("Decoding failed"))):this.audioContext.decodeAudioData(a).then(e).catch(t)}catch(e){t(e)}})}catch(e){return console.warn("Error loading sound:",e),null}}getSoundFileForBlockType(e){return this.soundFileMapping[e]||this.soundFileMapping.default}async playBlockFallSound(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.enabled||(!this.initialized||!this.audioContext)&&!this.initialize())return null;try{let a=this.soundBuffers[e];if(!a)try{let t=this.getSoundFileForBlockType(e);if(!(a=await this.loadSound(t)))return null;this.soundBuffers[e]=a}catch(t){return console.warn("Couldn't load sound for ".concat(e,":"),t),null}if(!a)return null;let s=this.audioContext.createBufferSource();s.buffer=a,s.playbackRate.value=.9+.3*Math.random();let n=this.audioContext.createGain();return n.gain.value=.7,s.connect(n),n.connect(this.audioContext.destination),s.start(this.audioContext.currentTime+t/1e3),s}catch(e){return console.warn("Error playing sound:",e),null}}playMultipleBlockFallSounds(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;if(this.enabled){if(!this.initialized&&!this.initialize())return;for(let a=0;a<Math.min(t,5);a++){let t=a*Math.random()*150;this.playBlockFallSound(e,t).catch(e=>{console.warn("Error in sound sequence:",e)})}}}resumeAudioContext(){this.audioContext&&"suspended"===this.audioContext.state&&this.audioContext.resume().catch(e=>{console.warn("Failed to resume audio context:",e)})}constructor(){this.audioContext=null,this.initialized=!1,this.soundBuffers={},this.enabled=!0,this.soundFileMapping={stone:"/assets/sounds/stone_break.mp3",coal:"/assets/sounds/stone_break.mp3",iron:"/assets/sounds/metal_break.mp3",gold:"/assets/sounds/metal_break.mp3",diamond:"/assets/sounds/crystal_break.mp3",emerald:"/assets/sounds/crystal_break.mp3",ruby:"/assets/sounds/crystal_break.mp3",sapphire:"/assets/sounds/crystal_break.mp3",amethyst:"/assets/sounds/crystal_break.mp3",wood:"/assets/sounds/wood_break.mp3",default:"/assets/sounds/stone_break.mp3"}}}let m=new u;var h=e=>{let{onBiomeClick:t,currentPickaxe:a,currentBiome:c,picksToShow:l,minedBlock:r}=e,[i,u]=(0,n.useState)({x:0,y:0}),[h,x]=(0,n.useState)(!1),[k,p]=(0,n.useState)((null==c?void 0:c.currentHealth)||0),[v,g]=(0,n.useState)((0,d.K)("/assets/pickaxes/wood.webp")),[b,j]=(0,n.useState)(!1),[y,N]=(0,n.useState)(null),[f,C]=(0,n.useState)(!1),[B,S]=(0,n.useState)(null),[w,I]=(0,n.useState)([]),P=(0,n.useRef)(null);(0,n.useEffect)(()=>{a&&g(a.getImageUrl())},[a]),(0,n.useEffect)(()=>{if(l){N(l),j(!0);let e=setTimeout(()=>{j(!1)},1500);return()=>clearTimeout(e)}},[l]);let T=(e,t)=>Math.random()*(t-e)+e,M=()=>Math.random().toString(36).substring(2,9);(0,n.useEffect)(()=>{if(r){S(r),C(!0);let e=Math.floor(T(3,7)),t=[];if(P.current){let a=P.current.offsetWidth,s=P.current.offsetHeight;for(let n=0;n<e;n++)t.push({id:M(),name:r.name,imageUrl:r.imageUrl,x:T(.3*a,.7*a),y:T(.3*s,.7*s)});I(e=>[...e,...t]);try{m.initialize(),m.resumeAudioContext(),m.playMultipleBlockFallSounds(r.name.toLowerCase(),e)}catch(e){console.warn("Error playing block sound:",e)}setTimeout(()=>{C(!1),I(e=>e.filter(e=>!t.some(t=>t.id===e.id)))},1800)}}},[r]),(0,n.useEffect)(()=>{let e=(null==c?void 0:c.currentHealth)||0;if(e<k&&P.current){let e=P.current;e.classList.add(o().shake),setTimeout(()=>{e.classList.remove(o().shake)},500)}p(e)},[null==c?void 0:c.currentHealth,k]);let E=()=>{x(!0),setTimeout(()=>x(!1),300)},A=(null==c?void 0:c.damagePercent)||100;return(0,s.jsxs)("div",{className:o().biomeContainer,children:[(0,s.jsxs)("div",{ref:P,className:"".concat(o().biome),onMouseMove:e=>{if(P.current){let t=P.current.getBoundingClientRect();u({x:e.clientX-t.left,y:e.clientY-t.top})}},onClick:()=>{t(),E();try{m.resumeAudioContext()}catch(e){console.warn("Failed to resume audio context:",e)}},style:{backgroundImage:"url(".concat(null==c?void 0:c.getImageUrl(),")"),backgroundSize:"cover",backgroundPosition:"center"},children:[b&&y&&(0,s.jsxs)("div",{className:o().scoreFlash,children:["+",y]}),w.map(e=>(0,s.jsx)("div",{className:o().minedBlock,style:{left:"".concat(e.x,"px"),top:"".concat(e.y,"px"),backgroundImage:"url(".concat(e.imageUrl,")"),backgroundSize:"contain",backgroundRepeat:"no-repeat",backgroundPosition:"center"}},e.id)),A<100&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:o().crackOverlay,style:{opacity:Math.max(.2,1-A/100),backgroundImage:"url(".concat((0,d.K)("/assets/crack_overlay.png"),")"),transform:"scale(".concat(1+(1-A/100),")"),filter:"contrast(".concat(100+(100-A),"%) brightness(").concat(100+(100-A)/2,"%)")}}),A<50&&(0,s.jsx)("div",{className:"".concat(o().crackOverlay," ").concat(o().secondaryCracks),style:{opacity:Math.max(.1,.8-A/50),backgroundImage:"url(".concat((0,d.K)("/assets/crack_overlay.png"),")"),transform:"scale(".concat(.7+(1-A/50),") rotate(45deg)")}}),A<25&&(0,s.jsx)("div",{className:"".concat(o().crackOverlay," ").concat(o().criticalCracks),style:{opacity:Math.max(.15,.9-A/25),backgroundImage:"url(".concat((0,d.K)("/assets/crack_overlay.png"),")"),transform:"scale(".concat(.9+(1-A/25),") rotate(-30deg)")}})]}),(0,s.jsx)("div",{className:o().pickaxeCursor,style:{left:"".concat(i.x,"px"),top:"".concat(i.y,"px")},children:(0,s.jsx)("img",{src:v,alt:"Pickaxe cursor",className:h?o().swingAnimation:""})})]}),(0,s.jsxs)("div",{className:o().horizontalHealthContainer,children:[(0,s.jsx)("div",{className:o().horizontalHealthBar,style:{width:"".concat(A,"%"),backgroundColor:A>60?"#72CB3B":A>30?"#FFCC00":"#FF6B6B"}}),(0,s.jsxs)("div",{className:o().horizontalHealthText,children:[Math.ceil(A),"%"]})]})]})},x=e=>{let{pickaxe:t,isSelected:a,onClick:c,className:l="",showTooltip:r=!0}=e,[i,d]=(0,n.useState)(!1),u=t.getPickaxe().maxHealth,m=t.health/u*100,h=t.getPickaxe(),x=m<=50?"rgb(".concat(255,", ").concat(Math.round(59+m/50*158),", ").concat(Math.round(59+-(m/50*59)),")"):"rgb(".concat(Math.round(255-(m-50)/50*141),", ").concat(Math.round(217-(m-50)/50*14),", ").concat(Math.round(0+(m-50)/50*59),")");return(0,s.jsxs)("div",{className:"".concat(o().inventorySlot," ").concat(a?o().selected:""," ").concat(l),onClick:()=>{c(t.id)},onMouseEnter:()=>{d(!0)},onMouseLeave:()=>{d(!1)},title:"".concat(t.type," Pickaxe - Health: ").concat(t.health,"/").concat(u),children:[(0,s.jsx)("img",{src:t.getImageUrl(),alt:t.type,className:o().inventoryItem}),(0,s.jsx)("div",{className:o().durabilityBar,children:(0,s.jsx)("div",{className:o().durabilityFill,style:{width:"".concat(m,"%"),backgroundColor:x}})}),r&&i&&(0,s.jsxs)("div",{className:o().quickItemTooltip,children:[(0,s.jsxs)("div",{className:o().quickItemName,children:[t.type.charAt(0).toUpperCase()+t.type.slice(1)," Pickaxe"]}),(0,s.jsxs)("div",{className:o().quickItemStats,children:[(0,s.jsxs)("div",{children:["Health: ",t.health,"/",u]}),(0,s.jsxs)("div",{children:["Strength: ",h.strength]}),(0,s.jsxs)("div",{children:["Critical: ",100*h.critical,"%"]}),(0,s.jsxs)("div",{children:["Power: ",h.power]}),(0,s.jsxs)("div",{children:["Rarity: ",h.rarity]})]})]})]})},k=e=>{let{isOpen:t,onClose:a,gameState:c,onSelectPickaxe:l}=e,r=t?"".concat(o().modal," ").concat(o().modalShow):o().modal,i=c.pickaxeInventory,d=i.currentItem,u=i.getCurrentItem(),[m,h]=(0,n.useState)(d),k=m?i.items.find(e=>e.id===m):u,p=e=>{console.log("handlePickaxePreview",e),h(e)};return(0,s.jsx)("div",{className:r,children:(0,s.jsxs)("div",{className:"".concat(o().modalContent," ").concat(o().shopModalContent),children:[(0,s.jsxs)("div",{className:o().modalHeader,children:[(0,s.jsx)("h2",{children:"Inventory"}),(0,s.jsx)("button",{className:o().closeBtn,onClick:a,children:"\xd7"})]}),(0,s.jsxs)("div",{className:o().inventorySection,children:[(0,s.jsx)("h3",{children:"Pickaxes"}),(0,s.jsx)("div",{className:o().pickaxeGrid,children:i.items.map(e=>(0,s.jsx)(x,{pickaxe:e,isSelected:e.id===m,onClick:p,showTooltip:!1},e.id))})]}),k&&(0,s.jsx)("div",{className:o().inventoryDetails,children:(0,s.jsxs)("div",{className:o().selectedItemDetails,children:[(0,s.jsxs)("h4",{children:[k.type," Pickaxe"]}),(0,s.jsxs)("p",{children:["Health: ",k.health," / ",k.getPickaxe().maxHealth]}),(0,s.jsxs)("p",{children:["Strength: ",k.getPickaxe().strength]}),m!==d&&(0,s.jsx)("button",{className:o().selectButton,onClick:()=>{m&&l&&(console.log("handlePickaxeSelect",m),l(m),a())},children:"Select Pickaxe"}),m===d&&(0,s.jsx)("div",{className:o().currentlyEquipped,children:"Currently Equipped"})]})})]})})},p=e=>{let{block:t,className:a="",showTooltip:c=!0}=e,[l,r]=(0,n.useState)(!1),i=t.getBlock();return(0,s.jsxs)("div",{className:"".concat(o().inventorySlot," ").concat(a),title:"".concat(t.name," - Quantity: ").concat(t.quantity),onMouseEnter:()=>{r(!0)},onMouseLeave:()=>{r(!1)},children:[(0,s.jsx)("img",{src:t.getImageUrl(),alt:t.name,className:o().inventoryItem}),(0,s.jsx)("div",{className:o().itemCount,children:t.quantity}),c&&l&&(0,s.jsxs)("div",{className:o().quickItemTooltip,children:[(0,s.jsx)("div",{className:o().quickItemName,children:t.name.charAt(0).toUpperCase()+t.name.slice(1)}),(0,s.jsxs)("div",{className:o().quickItemStats,children:[(0,s.jsxs)("div",{children:["Quantity: ",t.quantity]}),(0,s.jsxs)("div",{children:["Rarity: ",i.rarity]})]})]})]})};function v(e){let{items:t,totalSlots:a,itemType:n,renderItem:c,renderEmptySlot:l}=e,r=[],i=t.length,d=Math.max(1,Math.ceil(i/a));for(let e=0;e<d;e++){let d=Array(a).fill(null);for(let s=0;s<a;s++){let n=e*a+s;n<i&&(d[s]=t[n])}r.push((0,s.jsx)("div",{className:o().quickInventory,children:d.map((t,a)=>t?c(t,e,a):l(e,a))},"".concat(n,"-row-").concat(e)))}return(0,s.jsx)(s.Fragment,{children:r})}var g=e=>{let{gameState:t,onSelectPickaxe:a}=e,n=t.pickaxeInventory,c=t.blockInventory,l=n.currentItem,r=e=>{a&&e&&a(e)};return(0,s.jsxs)("div",{className:o().quickInventoryContainer,children:[(0,s.jsxs)("div",{className:o().quickInventorySection,children:[(0,s.jsx)("div",{className:o().quickInventoryLabel,children:"Pickaxes"}),(0,s.jsx)(v,{items:n.items,totalSlots:8,itemType:"pickaxe",renderItem:(e,t,a)=>(0,s.jsx)(x,{pickaxe:e,isSelected:e.id===l,onClick:r},e.id),renderEmptySlot:(e,t)=>(0,s.jsx)("div",{className:o().inventorySlot},"pickaxe-empty-".concat(e,"-").concat(t))})]}),(0,s.jsxs)("div",{className:o().quickInventorySection,children:[(0,s.jsx)("div",{className:o().quickInventoryLabel,children:"Blocks"}),(0,s.jsx)(v,{items:c.items,totalSlots:8,itemType:"block",renderItem:(e,t,a)=>(0,s.jsx)(p,{block:e},"block-".concat(e.name,"-").concat(t,"-").concat(a)),renderEmptySlot:(e,t)=>(0,s.jsx)("div",{className:o().inventorySlot},"block-empty-".concat(e,"-").concat(t))})]})]})},b=a(7390),j=a(1499);class y{toggleSound(e){this.soundEnabled=e}preloadSound(e,t){try{let a=new Audio(t);this.sounds.set(e,a)}catch(t){console.error("Error loading sound ".concat(e,": ").concat(t))}}playSound(e){if(this.soundEnabled)try{let t=this.sounds.get(e);t?(t.currentTime=0,t.play().catch(t=>{console.error("Error playing sound ".concat(e,": ").concat(t))})):console.warn('Sound "'.concat(e,'" not found'))}catch(t){console.error("Error playing sound ".concat(e,": ").concat(t))}}constructor(){this.sounds=new Map,this.soundEnabled=!0,this.preloadSound("error","/assets/sounds/error.mp3")}}let N=new y;var f=a(224),C=a(5927),B=a(640),S=e=>{let{isOpen:t,onClose:a,blockName:n}=e;if(!t)return null;let c=new C.f({name:n,quantity:1});return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"".concat(o().blockDetailsOverlay),onClick:a}),(0,s.jsx)("div",{className:"".concat(o().blockDetailsDrawer," ").concat(t?o().open:""),children:(0,s.jsxs)("div",{className:o().blockDetailsContent,children:[(0,s.jsxs)("div",{className:o().blockDetailsHeader,children:[(0,s.jsx)("h2",{children:c.name}),(0,s.jsx)("button",{className:o().closeBtn,onClick:a,children:"\xd7"})]}),(0,s.jsxs)("div",{className:o().blockDetailsBody,children:[(0,s.jsx)("div",{className:o().blockDetailsImage,children:(0,s.jsx)("img",{src:c.getImageUrl(),alt:c.name})}),(0,s.jsxs)("div",{className:o().blockDetailsStat,children:[(0,s.jsx)("span",{className:o().statLabel,children:"Rarity:"}),(0,s.jsx)("span",{className:o().statValue,children:c.getBlock().rarity})]})]})]})})]})};let w=e=>{switch(e){case"Common":default:return 100;case"Uncommon":return 200;case"Rare":return 500;case"Legendary":return 2e3}},I=e=>{switch(e){case"Common":default:return"#aaaaaa";case"Uncommon":return"#55ff55";case"Rare":return"#5555ff";case"Legendary":return"#ffaa00"}};var P=e=>{let{isOpen:t,onClose:a,gameState:c,onBuyBlock:l}=e,r=c.currentBiome.getBiome(),i=r.availableBlocks||[],d=(0,n.useRef)(null),[u,m]=(0,n.useState)(null);(0,n.useEffect)(()=>{if(t&&d.current){let e=()=>{let e=d.current;e&&(e.scrollHeight>e.clientHeight?e.classList.add(o().hasScroll):e.classList.remove(o().hasScroll))};e();let t=new ResizeObserver(e);return t.observe(d.current),()=>{d.current&&t.unobserve(d.current),t.disconnect()}}},[t,i]);let h=e=>{m(e)};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:o().biomesSection,children:[(0,s.jsxs)("p",{children:["Your picks: ",c.picks]}),0===i.length?(0,s.jsx)("p",{children:"No blocks available in this biome."}):(0,s.jsx)("div",{className:o().blocksGrid,children:i.map(e=>{let t=new C.f({name:e,quantity:1}),a=t.getImageUrl(),n=t.getBlock().rarity,i=w(n),d=c.picks>=i,u=I(n);return(0,s.jsxs)("div",{className:o().blockItem,onClick:()=>h(e),style:{cursor:"pointer"},children:[(0,s.jsxs)("div",{className:o().blockImageContainer,children:[(0,s.jsx)("img",{src:a,alt:e,className:o().blockItemImg}),(0,s.jsx)("div",{className:o().blockNameOverlay,children:e}),(0,s.jsx)("div",{className:o().rarityBadge,style:{backgroundColor:u},children:n})]}),(0,s.jsxs)("div",{className:o().blockItemContent,children:[(0,s.jsxs)("div",{className:o().blockDescription,children:["A ",n.toLowerCase()," ",e," block from the ",r.name," biome."]}),(0,s.jsx)("button",{className:"".concat(o().buyBlockButton," ").concat(d?"":o().buyBlockButtonDisabled),onClick:t=>{t.stopPropagation(),d&&l(e)},disabled:!d,children:d?"Buy (".concat(i," picks)"):"Need ".concat(i," picks")})]})]},e)})})]}),(0,s.jsx)(S,{isOpen:null!==u,onClose:()=>{m(null)},blockName:u||""})]})},T=a(6335),M=e=>{let{isOpen:t,onClose:a,gameState:c}=e,[l,r]=(0,n.useState)(!1);if(!t)return null;let i=b.ZP.exportGameState(c);return(0,s.jsx)("div",{className:o().modal+" "+o().modalShow,children:(0,s.jsxs)("div",{className:o().modalContent,children:[(0,s.jsxs)("div",{className:o().modalHeader,children:[(0,s.jsx)("h2",{children:"Export Game Save"}),(0,s.jsx)("button",{className:o().closeBtn,onClick:a,children:"\xd7"})]}),(0,s.jsxs)("div",{className:o().modalBody,children:[(0,s.jsx)("p",{children:"Copy the code below or download it as a file to save your current game progress:"}),(0,s.jsx)("div",{className:o().exportCodeContainer,children:(0,s.jsx)("textarea",{className:o().exportCode,value:i,readOnly:!0,rows:6})}),(0,s.jsxs)("div",{className:o().exportActions,children:[(0,s.jsx)("button",{className:o().exportActionButton,onClick:()=>{navigator.clipboard.writeText(i),r(!0),setTimeout(()=>r(!1),2e3)},children:l?"Copied!":"Copy to Clipboard"}),(0,s.jsx)("button",{className:o().exportActionButton,onClick:()=>{let e=document.createElement("a"),t=new Blob([i],{type:"text/plain"});e.href=URL.createObjectURL(t),e.download="mathcrafter-save-".concat(Date.now(),".txt"),document.body.appendChild(e),e.click(),document.body.removeChild(e)},children:"Download as File"})]})]})]})})};let E=e=>{switch(e){case"Common":default:return"#aaaaaa";case"Uncommon":return"#55ff55";case"Rare":return"#5555ff";case"Epic":return"#aa00aa";case"Seasonal":return"#ff5555";case"Legendary":return"#ffaa00"}};var A=e=>{let{isOpen:t,onClose:a,gameState:c,onBuyItem:l}=e,[r,i]=(0,n.useState)(!0),u=(0,n.useRef)(null),m=B.o.items,h=r?m.filter(e=>c.currentBiome.getBiome().availablePickaxes.includes(e.name.toLowerCase())):m;(0,n.useEffect)(()=>{if(t&&u.current){let e=()=>{let e=u.current;e&&(e.scrollHeight>e.clientHeight?e.classList.add(o().hasScroll):e.classList.remove(o().hasScroll))};e();let t=new ResizeObserver(e);return t.observe(u.current),()=>{u.current&&t.unobserve(u.current),t.disconnect()}}},[t,h]);let x=(e,t)=>c.blockInventory.hasBlock(e,t),k=e=>{let{itemType:t,amount:a}=e.cost,s=c.blockInventory.getBlockQuantity(t);return s<a?"Need ".concat(a-s," more ").concat(t):"Buy (".concat(a," ").concat(t,")")};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:o().toggleContainer,children:[(0,s.jsxs)("label",{className:o().toggleSwitch,children:[(0,s.jsx)("input",{type:"checkbox",checked:r,onChange:()=>{i(e=>!e)}}),(0,s.jsx)("span",{className:o().toggleSlider})]}),(0,s.jsx)("span",{className:o().toggleLabel,children:r?"Showing biome pickaxes only":"Showing all pickaxes"})]}),(0,s.jsx)("div",{className:o().biomesSection,children:(0,s.jsx)("div",{className:o().pickaxesGrid,children:h.map(e=>{let t=x(e.cost.itemType,e.cost.amount),a=E(e.rarity);return(0,s.jsxs)("div",{className:o().pickaxeItem,children:[(0,s.jsxs)("div",{className:o().pickaxeImageContainer,children:[(0,s.jsx)("img",{src:"".concat((0,d.K)("/assets/pickaxes/".concat(e.name.toLowerCase(),".png"))),alt:"".concat(e.name," Pickaxe"),className:o().pickaxeItemImg}),(0,s.jsx)("div",{className:o().rarityBadge,style:{backgroundColor:a,top:"auto",bottom:"5px"},children:e.rarity})]}),(0,s.jsxs)("div",{className:o().pickaxeItemContent,children:[(0,s.jsxs)("div",{className:o().pickaxeInfo,children:[(0,s.jsxs)("div",{className:o().itemName,children:[e.name.charAt(0).toUpperCase()+e.name.slice(1)," Pickaxe"]}),(0,s.jsxs)("div",{className:o().itemDescription,children:["Strength: ",e.strength," | Durability: ",e.maxHealth," | Crit: ",100*e.critical,"%"]}),(0,s.jsxs)("div",{className:o().unlockCost,children:["Cost: ",(0,s.jsxs)("span",{className:t?o().affordableCost:o().unaffordableCost,children:[e.cost.amount," ",e.cost.itemType]}),(0,s.jsxs)("div",{children:["(You have: ",c.blockInventory.getBlockQuantity(e.cost.itemType),")"]})]})]}),(0,s.jsx)("button",{className:"".concat(o().buyPickaxeButton," ").concat(t?"":o().buyPickaxeButtonDisabled),onClick:()=>l(e.name,0),disabled:!t,children:k(e)})]})]},e.name)})})})]})},F=e=>{let{isOpen:t,onClose:a,gameState:c,onUnlockBiome:l,onSelectBiome:r,selectionMode:i=!1}=e,u=T.a.items,m=c.unlockedBiomes,h=c.currentBiome.type,x=c.currentBiome.currentHealth<=0,k=(0,n.useRef)(null),[p,v]=(0,n.useState)(null);console.log("BiomesModal opened - Selection mode: ".concat(i,", Biome destroyed: ").concat(x,", Current health: ").concat(c.currentBiome.currentHealth)),(0,n.useEffect)(()=>{if(t&&k.current){let e=()=>{let e=k.current;e&&(e.scrollHeight>e.clientHeight?e.classList.add(o().hasScroll):e.classList.remove(o().hasScroll))};e();let t=new ResizeObserver(e);return t.observe(k.current),()=>{k.current&&t.unobserve(k.current),t.disconnect()}}},[t,u]);let g=e=>m.includes(e.toLowerCase()),b=e=>{l&&l(e.toLowerCase())},j=(e,t)=>{e.stopPropagation(),r&&g(t)&&t.toLowerCase()!==h&&(r(t.toLowerCase()),a())},y=e=>{if(g(e))return!0;let t=T.a.getItemByName(e);return!t.cost||c.blockInventory.hasBlock(t.cost.itemType,t.cost.amount)},N=(e,t)=>{e.stopPropagation(),v(t)};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:o().biomesSection,children:(0,s.jsx)("div",{className:o().biomesGrid,children:u.map(e=>{let t=g(e.name),a=y(e.name),n=e.name.toLowerCase()===h;return(0,s.jsxs)("div",{className:"".concat(o().biomeItem," \n                                        ").concat(t?o().biomeUnlocked:o().biomeLocked,"\n                                        ").concat(n?o().biomeSelected:""),children:[(0,s.jsxs)("div",{className:o().biomeImageContainer,children:[(0,s.jsx)("img",{src:(0,d.K)("/assets/biomes/".concat(e.name.toLowerCase(),".png")),alt:e.name,className:o().biomeItemImg}),!t&&(0,s.jsx)("div",{className:o().lockOverlay,children:(0,s.jsx)("img",{src:(0,d.K)("/assets/padlock.svg"),alt:"Locked",className:o().lockIcon})}),(0,s.jsxs)("div",{className:o().biomeNameOverlay,children:[e.name,t&&(0,s.jsx)("span",{className:o().unlockedIndicator,children:"✓"}),n&&(0,s.jsx)("span",{className:o().currentIndicator,children:" (Current)"})]})]}),(0,s.jsxs)("div",{className:o().availableBlocks,children:[(0,s.jsx)("span",{children:"Available Blocks:"}),(0,s.jsx)("div",{className:o().blockImagesContainer,children:e.availableBlocks.map(e=>(0,s.jsxs)("div",{className:o().blockImageWrapper,onClick:t=>N(t,e),style:{cursor:"pointer"},children:[(0,s.jsx)("img",{src:(0,d.K)("/assets/blocks/".concat(e,".png")),alt:e,className:o().blockImage}),(0,s.jsx)("div",{className:o().blockName,children:e})]},e))})]}),(0,s.jsxs)("div",{className:o().availablePickaxes,children:[(0,s.jsx)("span",{children:"Available Pickaxes:"}),(0,s.jsx)("div",{className:o().blockImagesContainer,children:e.availablePickaxes.length>0?e.availablePickaxes.map(e=>(0,s.jsxs)("div",{className:o().blockImageWrapper,children:[(0,s.jsx)("img",{src:(0,d.K)("/assets/pickaxes/".concat(e,".png")),alt:e,className:o().blockImage}),(0,s.jsx)("div",{className:o().blockName,children:e})]},e)):(0,s.jsx)("div",{className:o().noPickaxes,children:"No pickaxes available"})})]}),(0,s.jsxs)("div",{className:o().itemInfo,children:[(0,s.jsx)("div",{className:o().itemDescription,children:e.description}),!t&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:o().unlockCost,children:e.cost?(0,s.jsxs)(s.Fragment,{children:["Cost:",(0,s.jsxs)("div",{className:o().costItemContainer,children:[(0,s.jsxs)("div",{className:o().costItemImgWrapper,children:[(0,s.jsx)("img",{src:(0,d.K)("/assets/blocks/".concat(e.cost.itemType,".png")),alt:e.cost.itemType,className:o().costItemImg}),(0,s.jsx)("span",{className:o().costItemBadge,children:e.cost.amount})]}),(0,s.jsx)("span",{className:a?o().affordableCost:o().unaffordableCost,children:e.cost.itemType.replace(/_/g," ")})]})]}):(0,s.jsx)("span",{className:o().affordableCost,children:"Free"})}),(0,s.jsx)("button",{className:"".concat(o().unlockButton," ").concat(a?"":o().unlockButtonDisabled),onClick:()=>b(e.name),disabled:!a,children:a?"Unlock":"Not enough resources"})]}),t&&i&&!n&&(0,s.jsx)("button",{className:o().selectButton,onClick:t=>j(t,e.name),children:"Select"}),t&&i&&n&&(0,s.jsx)("div",{className:o().currentlyEquipped,children:"Currently Selected"})]})]},e.name)})})}),(0,s.jsx)(S,{isOpen:null!==p,onClose:()=>{v(null)},blockName:p||""})]})},H=e=>{let{isOpen:t,onClose:a,gameState:c,onBuyPickaxe:l,onUnlockBiome:r,onSelectBiome:i,activeTab:d="pickaxes"}=e,[u,m]=(0,n.useState)(d),h=(0,n.useRef)(null);(0,n.useEffect)(()=>{m(d)},[d]),(0,n.useEffect)(()=>{if(t&&h.current){let e=()=>{let e=h.current;e&&(e.scrollHeight>e.clientHeight?e.classList.add(o().hasScroll):e.classList.remove(o().hasScroll))};e();let t=new ResizeObserver(e);return t.observe(h.current),()=>{h.current&&t.unobserve(h.current),t.disconnect()}}},[t,u]);let x=e=>{m(e)};return(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("div",{className:"".concat(o().biomesDrawer," ").concat(o().alwaysOpenDrawer),children:[(0,s.jsxs)("div",{className:o().biomesDrawerHeader,children:[(0,s.jsx)("h2",{children:(()=>{switch(u){case"pickaxes":return"Shop Pickaxes";case"biomes":return c.currentBiome.currentHealth<=0?"Select Biome":"Available Biomes";default:return"Tools"}})()}),(0,s.jsxs)("div",{className:o().toolsTabs,children:[(0,s.jsx)("button",{className:"".concat(o().toolsTab," ").concat("pickaxes"===u?o().toolsTabActive:""),onClick:()=>x("pickaxes"),children:"Pickaxes"}),(0,s.jsx)("button",{className:"".concat(o().toolsTab," ").concat("biomes"===u?o().toolsTabActive:""),onClick:()=>x("biomes"),children:"Biomes"})]})]}),(0,s.jsxs)("div",{ref:h,className:o().biomesDrawerContent,"data-drawer-type":"tools",children:["pickaxes"===u&&(0,s.jsx)("div",{className:o().toolsTabContent,children:(0,s.jsx)(A,{isOpen:!0,onClose:()=>{},gameState:c,onBuyItem:l})}),"biomes"===u&&(0,s.jsx)("div",{className:o().toolsTabContent,children:(0,s.jsx)(F,{isOpen:!0,onClose:()=>{},gameState:c,onUnlockBiome:r,onSelectBiome:i,selectionMode:!0})})]})]})})},L=()=>{let[e,t]=(0,n.useState)(!1),[a,c]=(0,n.useState)(b.ZP.loadGameState()),[u,m]=(0,n.useState)({num1:0,num2:0,operator:"+",answer:0}),[x,p]=(0,n.useState)(""),[v,y]=(0,n.useState)(!1),[S,w]=(0,n.useState)(!1),[I,E]=(0,n.useState)(!1),[A,F]=(0,n.useState)(!1),[L,D]=(0,n.useState)(!1),[q,O]=(0,n.useState)(!1),[R,U]=(0,n.useState)(""),[z,_]=(0,n.useState)(!1),[G,K]=(0,n.useState)(""),[Z,Y]=(0,n.useState)(!1),[W,Q]=(0,n.useState)(!1),[V,X]=(0,n.useState)(null),[J,$]=(0,n.useState)(null),[ee,et]=(0,n.useState)(null),[ea,es]=(0,n.useState)(!1),[en,ec]=(0,n.useState)(!1),eo=(0,n.useRef)(null),[el,er]=(0,n.useState)("pickaxes"),[ei,ed]=(0,n.useState)(!1);(0,n.useEffect)(()=>{t(!0),m(b.ZP.generateMathProblem()),c(b.ZP.loadGameState())},[]),(0,n.useEffect)(()=>{e&&!v&&b.ZP.saveGameState(a)},[a,e,v]),(0,n.useEffect)(()=>{console.log("gameState",a);let e=a.currentBiome;e.currentHealth<=0&&(console.log("Biome destroyed! Opening selection modal..."),K(e.type),_(!0),setTimeout(()=>{_(!1)},3e3))},[a]),(0,n.useEffect)(()=>{L&&eo.current&&setTimeout(()=>{var e;null===(e=eo.current)||void 0===e||e.focus()},100)},[L]);let eu=()=>{m(b.ZP.generateMathProblem()),p("")},em=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],s=a.pickaxeInventory.getCurrentItem();s&&(X(e=e||s.getPicks()),setTimeout(()=>{X(null)},2e3)),eh(),c(a=>{let s=a.pickaxeInventory.getCurrentItem();if(!s)return console.log("No current pickaxe found"),a;let n=a.increasePicks(e||0);if(t){let e=a.currentBiome.withDamage(s.getDamageToBiome(a.currentBiome.getBiome()));return console.log("Biome health: ".concat(e.currentHealth,"/").concat(e.getBiome().maxHealth)),n.withCurrentBiome(e)}return a})},eh=()=>{let e=a.pickaxeInventory.getCurrentItem();if(e&&Math.random()<e.getPickaxe().critical){let e=a.currentBiome;if(!e)return;let t=e.getBiome().availableBlocks;if(t&&t.length>0){let e=Math.floor(Math.random()*t.length),a=t[e],s=new C.f({name:a,quantity:1});$({name:a,imageUrl:s.getImageUrl()}),et(s),setTimeout(()=>{et(null)},3e3),c(e=>{let t=e.blockInventory.addBlock(a,1);return e.withBlockInventory(t)})}}},ex=()=>{Y(!0),Q(!0),N.playSound("error"),document.body.classList.add("screen-shake"),setTimeout(()=>{Q(!1)},1e3),setTimeout(()=>{Y(!1),document.body.classList.remove("screen-shake")},500),c(e=>{let t=e.pickaxeInventory.getCurrentItem();if(null===t)return e;let a=t.withDamage(1),s=new j.t({id:a.id,type:a.type,health:a.health});if(s.health<=0)return ek(e);let n=e.pickaxeInventory.withCurrentItem(s);return e.withPickaxeInventory(n)})},ek=e=>{let t=e.pickaxeInventory.getCurrentItem();if(!t)return e;if(U(t.type),O(!0),setTimeout(()=>{O(!1)},3e3),e.pickaxeInventory.length<=1)return y(!0),e;let a=e.pickaxeInventory.removeCurrentItem();return e.withPickaxeInventory(a)},ep=()=>{E(e=>!e)},ev=()=>{ec(e=>!e)},eg=e=>{if(!a.pickaxeInventory.items.find(t=>t.id===e)){console.error("Selected pickaxe not found in inventory");return}let t=a.pickaxeInventory.withCurrentItemId(e);c(e=>{let a=e.withPickaxeInventory(t);return setTimeout(()=>{b.ZP.saveGameState(a)},0),a}),E(!1)};a.pickaxeInventory.length;let eb=()=>{ed(e=>!e)};return e?(0,s.jsxs)("div",{className:o().gameContainer,children:[(0,s.jsxs)("div",{className:o().gameHeader,children:[(0,s.jsx)("h1",{children:"MathCrafter"}),(0,s.jsx)("div",{className:o().avatar,children:(0,s.jsx)("img",{src:(0,d.K)("/assets/avatars/avatar.png"),alt:"Player Avatar",className:o().avatarImage,onClick:ep,style:{cursor:"pointer"}})}),(0,s.jsx)("div",{className:o().stats,children:(0,s.jsxs)("div",{className:o().statItem,children:[(0,s.jsx)("img",{src:(0,d.K)("/assets/picks.png"),alt:"Picks",className:o().picksIcon}),(0,s.jsx)("span",{children:a.picks})]})}),(0,s.jsxs)("div",{className:o().headerButtons,children:[(0,s.jsxs)("button",{className:"".concat(o().blocksPulldownButton," ").concat(ei?o().blocksPulldownButtonActive:""),onClick:eb,children:["Blocks ",(0,s.jsx)("span",{className:o().pulldownArrow,children:ei?"▲":"▼"})]}),(0,s.jsx)("button",{className:o().exportGameButton,onClick:ev,children:"Export"})]})]}),ei&&(0,s.jsxs)("div",{className:o().globalBlocksPanel,children:[(0,s.jsxs)("div",{className:o().globalBlocksPanelHeader,children:[(0,s.jsxs)("h2",{children:["Buy Blocks from ",a.currentBiome.getBiome().name," biome"]}),(0,s.jsx)("button",{className:o().closeBlocksPanelBtn,onClick:eb,children:"▲"})]}),(0,s.jsx)("div",{className:o().globalBlocksPanelContent,children:(0,s.jsx)(P,{isOpen:!0,onClose:()=>{},gameState:a,onBuyBlock:e=>{a.picks<100||c(t=>{let a=t.increasePicks(-100),s=a.blockInventory.addBlock(e,1);return et(new C.f({name:e,quantity:1})),setTimeout(()=>{et(null)},3e3),a.withBlockInventory(s)})}})})]}),(0,s.jsxs)("div",{className:o().gameArea,children:[(0,s.jsx)(h,{onBiomeClick:()=>{if(L)return;let e=a.pickaxeInventory.getCurrentItem();e&&(Math.random()<=e.getPickaxe().critical?(D(!0),eu()):em(e.getPickaxe().strength,!0))},currentPickaxe:a.pickaxeInventory.getCurrentItem(),currentBiome:a.currentBiome,picksToShow:V,minedBlock:J}),(0,s.jsx)(g,{gameState:a,onSelectPickaxe:eg})]}),(0,s.jsx)(H,{isOpen:!0,onClose:()=>{},gameState:a,onBuyPickaxe:(e,t)=>{let s=B.o.getItemByName(e);if(!s){console.error("Pickaxe with name ".concat(e," not found"));return}let n=s.cost.itemType,o=s.cost.amount;if(!a.blockInventory.hasBlock(n,o)){console.error("Not enough ".concat(n," to craft ").concat(e," pickaxe"));return}let l=new j.t({id:null,type:e,health:null}),r=a.blockInventory;r=r.addBlock(n,-o);let i=new f.C0({items:[...a.pickaxeInventory.items,l],currentItem:l.id});c(a.withPickaxeInventory(i).withBlockInventory(r))},onUnlockBiome:e=>{if(a.unlockedBiomes.includes(e))return;let t=T.a.getItemByName(e);if(!t){console.error("Biome with name ".concat(e," not found"));return}if(t.cost){let s=t.cost.itemType,n=t.cost.amount;if(!a.blockInventory.hasBlock(s,n)){console.error("Not enough ".concat(s," to unlock ").concat(e," biome"));return}c(t=>{let a=t.blockInventory;a=a.addBlock(s,-n);let c=[...t.unlockedBiomes,e];return new l.D({...t,unlockedBiomes:c,blockInventory:a})})}else c(t=>{let a=[...t.unlockedBiomes,e];return new l.D({...t,unlockedBiomes:a})})},onSelectBiome:e=>{c(t=>{let a=new r.k({id:null,type:e,currentHealth:null});return t.withCurrentBiome(a)})},activeTab:el}),(0,s.jsx)("div",{className:"".concat(o().modal," ").concat(L?o().modalShow:""),children:(0,s.jsxs)("div",{className:"".concat(o().modalContent," ").concat(o().questionModalContent),children:[(0,s.jsxs)("div",{className:o().modalHeader,children:[(0,s.jsx)("h2",{children:"Math Problem"}),(0,s.jsx)("button",{className:o().closeBtn,onClick:()=>{D(!1)},children:"\xd7"})]}),(0,s.jsxs)("form",{className:"".concat(o().mathProblem," ").concat(Z?o().wrongAnswerShake+" "+o().wrongAnswerFlash:""),onSubmit:e=>{e.preventDefault();let t=parseInt(x);isNaN(t)||(t===u.answer?(em(null,!0),eu(),p(""),D(!1)):(ex(),p("")))},children:[(0,s.jsxs)("div",{className:o().question,children:[u.num1," ",u.operator," ",u.num2," = ?"]}),(0,s.jsxs)("div",{className:o().answerArea,children:[(0,s.jsx)("input",{ref:eo,type:"number",className:o().answer,value:x,onChange:e=>p(e.target.value),autoFocus:!0}),(0,s.jsx)("button",{type:"submit",className:o().submitBtn,children:"Mine!"})]}),(0,s.jsxs)("div",{className:o().numpad,children:[[7,8,9,4,5,6,1,2,3,0].map(e=>(0,s.jsx)("button",{type:"button",className:o().numpadBtn,onClick:()=>p(t=>t+e.toString()),children:e},e)),(0,s.jsx)("button",{type:"button",className:"".concat(o().numpadBtn," ").concat(o().clearBtn),onClick:()=>p(""),children:"Clear"}),(0,s.jsx)("button",{type:"button",className:"".concat(o().numpadBtn," ").concat(o().deleteBtn),onClick:()=>p(e=>e.slice(0,-1)),children:"←"})]})]})]})}),W&&(0,s.jsx)("div",{className:o().incorrectText,children:"INCORRECT!"}),(0,s.jsx)(k,{isOpen:I,onClose:ep,gameState:a,onSelectPickaxe:eg}),(0,s.jsx)(M,{isOpen:en,onClose:ev,gameState:a}),(0,s.jsx)(i,{isOpen:v,onRestart:()=>{let e=b.ZP.loadGameState();c(e),y(!1),D(!1),eu(),b.ZP.saveGameState(e)}}),q&&(0,s.jsxs)("div",{className:o().brokenPickaxeNotification,children:[(0,s.jsx)("h3",{children:"Pickaxe Destroyed!"}),(0,s.jsxs)("p",{children:["Your ",R," Pickaxe has broken."]})]}),z&&(0,s.jsxs)("div",{className:o().biomeDestroyedNotification,children:[(0,s.jsx)("h3",{children:"Biome Conquered!"}),(0,s.jsxs)("p",{children:["You've mined the ",G," biome."]}),(0,s.jsx)("p",{children:"Please select a new biome to explore!"})]}),ee&&(0,s.jsxs)("div",{className:o().blockAddedNotification,children:[(0,s.jsx)("img",{src:ee.getImageUrl(),alt:ee.name}),(0,s.jsx)("div",{children:(0,s.jsxs)("div",{children:["+1 ",ee.name]})})]})]}):(0,s.jsx)("div",{className:o().gameContainer,children:"Loading..."})}}}]);