"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[794],{794:function(e,t,a){a.r(t),a.d(t,{default:function(){return L}});var s=a(5893),c=a(7294),n=a(6784),l=a.n(n),o=a(1485),r=a(8751),i=a(640),d=a(2627);let m=e=>{switch(e){case"Common":default:return"#aaaaaa";case"Uncommon":return"#55ff55";case"Rare":return"#5555ff";case"Epic":return"#aa00aa";case"Seasonal":return"#ff5555";case"Legendary":return"#ffaa00"}};var u=e=>{let{isOpen:t,onClose:a,gameState:n,onBuyItem:o}=e,[r,u]=(0,c.useState)(!0),h=(0,c.useRef)(null),x=i.o.items,k=r?x.filter(e=>n.currentBiome.getBiome().availablePickaxes.includes(e.name.toLowerCase())):x;(0,c.useEffect)(()=>{if(t&&h.current){let e=()=>{let e=h.current;e&&(e.scrollHeight>e.clientHeight?e.classList.add(l().hasScroll):e.classList.remove(l().hasScroll))};e();let t=new ResizeObserver(e);return t.observe(h.current),()=>{h.current&&t.unobserve(h.current),t.disconnect()}}},[t,k]);let v=(e,t)=>n.blockInventory.hasBlock(e,t),p=e=>{let{itemType:t,amount:a}=e.cost,s=n.blockInventory.getBlockQuantity(t);return s<a?"Need ".concat(a-s," more ").concat(t):"Buy (".concat(a," ").concat(t,")")};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"".concat(l().biomesOverlay," ").concat(t?l().biomesOverlayOpen:""),onClick:a}),(0,s.jsxs)("div",{className:"".concat(l().biomesDrawer," ").concat(t?l().biomesDrawerOpen:""),children:[(0,s.jsx)("div",{className:l().biomesDrawerHandle,onClick:a}),(0,s.jsxs)("div",{className:l().biomesDrawerHeader,children:[(0,s.jsx)("h2",{children:"Shop Pickaxes"}),(0,s.jsxs)("div",{className:l().toggleContainer,children:[(0,s.jsxs)("label",{className:l().toggleSwitch,children:[(0,s.jsx)("input",{type:"checkbox",checked:r,onChange:()=>{u(e=>!e)}}),(0,s.jsx)("span",{className:l().toggleSlider})]}),(0,s.jsx)("span",{className:l().toggleLabel,children:r?"Showing biome pickaxes only":"Showing all pickaxes"})]})]}),(0,s.jsx)("div",{ref:h,className:l().biomesDrawerContent,"data-drawer-type":"pickaxes",children:(0,s.jsx)("div",{className:l().biomesSection,children:(0,s.jsx)("div",{className:l().pickaxesGrid,children:k.map(e=>{let t=v(e.cost.itemType,e.cost.amount),a=m(e.rarity);return(0,s.jsxs)("div",{className:l().pickaxeItem,children:[(0,s.jsxs)("div",{className:l().pickaxeImageContainer,children:[(0,s.jsx)("img",{src:"".concat((0,d.K)("/assets/pickaxes/".concat(e.name.toLowerCase(),".png"))),alt:"".concat(e.name," Pickaxe"),className:l().pickaxeItemImg}),(0,s.jsx)("div",{className:l().rarityBadge,style:{backgroundColor:a,top:"auto",bottom:"5px"},children:e.rarity})]}),(0,s.jsxs)("div",{className:l().pickaxeItemContent,children:[(0,s.jsxs)("div",{className:l().pickaxeInfo,children:[(0,s.jsxs)("div",{className:l().itemName,children:[e.name.charAt(0).toUpperCase()+e.name.slice(1)," Pickaxe"]}),(0,s.jsxs)("div",{className:l().itemDescription,children:["Strength: ",e.strength," | Durability: ",e.maxHealth," | Crit: ",100*e.critical,"%"]}),(0,s.jsxs)("div",{className:l().unlockCost,children:["Cost: ",(0,s.jsxs)("span",{className:t?l().affordableCost:l().unaffordableCost,children:[e.cost.amount," ",e.cost.itemType]}),(0,s.jsxs)("div",{children:["(You have: ",n.blockInventory.getBlockQuantity(e.cost.itemType),")"]})]})]}),(0,s.jsx)("button",{className:"".concat(l().buyPickaxeButton," ").concat(t?"":l().buyPickaxeButtonDisabled),onClick:()=>o(e.name,0),disabled:!t,children:p(e)})]})]},e.name)})})})})]})]})},h=e=>{let{isOpen:t,onRestart:a}=e;return(0,s.jsx)("div",{className:"".concat(l().modal," ").concat(t?l().modalShow:""),children:(0,s.jsxs)("div",{className:l().modalContent,children:[(0,s.jsx)("h2",{children:"Game Over!"}),(0,s.jsx)("p",{children:"You've lost all your pickaxes!"}),(0,s.jsx)("button",{className:l().restartBtn,onClick:a,children:"Play Again"})]})})},x=e=>{let{onBiomeClick:t,currentPickaxe:a,currentBiome:n,picksToShow:o,minedBlock:r}=e,[i,m]=(0,c.useState)({x:0,y:0}),[u,h]=(0,c.useState)(!1),[x,k]=(0,c.useState)((null==n?void 0:n.currentHealth)||0),[v,p]=(0,c.useState)((0,d.K)("/assets/pickaxes/wood.webp")),[j,g]=(0,c.useState)(!1),[b,N]=(0,c.useState)(null),[y,C]=(0,c.useState)(!1),[f,I]=(0,c.useState)(null),B=(0,c.useRef)(null);(0,c.useEffect)(()=>{a&&p(a.getImageUrl())},[a]),(0,c.useEffect)(()=>{if(o){N(o),g(!0);let e=setTimeout(()=>{g(!1)},1500);return()=>clearTimeout(e)}},[o]),(0,c.useEffect)(()=>{if(r){I(r),C(!0);let e=setTimeout(()=>{C(!1)},1500);return()=>clearTimeout(e)}},[r]),(0,c.useEffect)(()=>{let e=(null==n?void 0:n.currentHealth)||0;if(e<x&&B.current){let e=B.current;e.classList.add(l().shake),setTimeout(()=>{e.classList.remove(l().shake)},500)}k(e)},[null==n?void 0:n.currentHealth,x]);let S=()=>{h(!0),setTimeout(()=>h(!1),300)},w=(null==n?void 0:n.damagePercent)||100;return(0,s.jsxs)("div",{className:l().biomeContainer,children:[(0,s.jsxs)("div",{ref:B,className:"".concat(l().biome),onMouseMove:e=>{if(B.current){let t=B.current.getBoundingClientRect();m({x:e.clientX-t.left,y:e.clientY-t.top})}},onClick:()=>{t(),S()},style:{backgroundImage:"url(".concat(null==n?void 0:n.getImageUrl(),")"),backgroundSize:"cover",backgroundPosition:"center"},children:[j&&b&&(0,s.jsxs)("div",{className:l().scoreFlash,children:["+",b]}),y&&f&&(0,s.jsx)("div",{className:l().minedBlock,style:{top:"50%",left:"50%",backgroundImage:"url(".concat(f.imageUrl,")"),backgroundSize:"contain",backgroundRepeat:"no-repeat",backgroundPosition:"center"}}),w<100&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:l().crackOverlay,style:{opacity:Math.max(.2,1-w/100),backgroundImage:"url(".concat((0,d.K)("/assets/crack_overlay.png"),")"),transform:"scale(".concat(1+(1-w/100),")"),filter:"contrast(".concat(100+(100-w),"%) brightness(").concat(100+(100-w)/2,"%)")}}),w<50&&(0,s.jsx)("div",{className:"".concat(l().crackOverlay," ").concat(l().secondaryCracks),style:{opacity:Math.max(.1,.8-w/50),backgroundImage:"url(".concat((0,d.K)("/assets/crack_overlay.png"),")"),transform:"scale(".concat(.7+(1-w/50),") rotate(45deg)")}}),w<25&&(0,s.jsx)("div",{className:"".concat(l().crackOverlay," ").concat(l().criticalCracks),style:{opacity:Math.max(.15,.9-w/25),backgroundImage:"url(".concat((0,d.K)("/assets/crack_overlay.png"),")"),transform:"scale(".concat(.9+(1-w/25),") rotate(-30deg)")}})]}),(0,s.jsx)("div",{className:l().pickaxeCursor,style:{left:"".concat(i.x,"px"),top:"".concat(i.y,"px")},children:(0,s.jsx)("img",{src:v,alt:"Pickaxe cursor",className:u?l().swingAnimation:""})})]}),(0,s.jsxs)("div",{className:l().horizontalHealthContainer,children:[(0,s.jsx)("div",{className:l().horizontalHealthBar,style:{width:"".concat(w,"%"),backgroundColor:w>60?"#72CB3B":w>30?"#FFCC00":"#FF6B6B"}}),(0,s.jsxs)("div",{className:l().horizontalHealthText,children:[Math.ceil(w),"%"]})]})]})},k=e=>{let{pickaxe:t,isSelected:a,onClick:n,className:o="",showTooltip:r=!0}=e,[i,d]=(0,c.useState)(!1),m=t.getPickaxe().maxHealth,u=t.health/m*100,h=t.getPickaxe(),x=u<=50?"rgb(".concat(255,", ").concat(Math.round(59+u/50*158),", ").concat(Math.round(59+-(u/50*59)),")"):"rgb(".concat(Math.round(255-(u-50)/50*141),", ").concat(Math.round(217-(u-50)/50*14),", ").concat(Math.round(0+(u-50)/50*59),")");return(0,s.jsxs)("div",{className:"".concat(l().inventorySlot," ").concat(a?l().selected:""," ").concat(o),onClick:()=>{n(t.id)},onMouseEnter:()=>{d(!0)},onMouseLeave:()=>{d(!1)},title:"".concat(t.type," Pickaxe - Health: ").concat(t.health,"/").concat(m),children:[(0,s.jsx)("img",{src:t.getImageUrl(),alt:t.type,className:l().inventoryItem}),(0,s.jsx)("div",{className:l().durabilityBar,children:(0,s.jsx)("div",{className:l().durabilityFill,style:{width:"".concat(u,"%"),backgroundColor:x}})}),r&&i&&(0,s.jsxs)("div",{className:l().quickItemTooltip,children:[(0,s.jsxs)("div",{className:l().quickItemName,children:[t.type.charAt(0).toUpperCase()+t.type.slice(1)," Pickaxe"]}),(0,s.jsxs)("div",{className:l().quickItemStats,children:[(0,s.jsxs)("div",{children:["Health: ",t.health,"/",m]}),(0,s.jsxs)("div",{children:["Strength: ",h.strength]}),(0,s.jsxs)("div",{children:["Critical: ",100*h.critical,"%"]}),(0,s.jsxs)("div",{children:["Power: ",h.power]}),(0,s.jsxs)("div",{children:["Rarity: ",h.rarity]})]})]})]})},v=e=>{let{isOpen:t,onClose:a,gameState:n,onSelectPickaxe:o}=e,r=t?"".concat(l().modal," ").concat(l().modalShow):l().modal,i=n.pickaxeInventory,d=i.currentItem,m=i.getCurrentItem(),[u,h]=(0,c.useState)(d),x=u?i.items.find(e=>e.id===u):m,v=e=>{console.log("handlePickaxePreview",e),h(e)};return(0,s.jsx)("div",{className:r,children:(0,s.jsxs)("div",{className:"".concat(l().modalContent," ").concat(l().shopModalContent),children:[(0,s.jsxs)("div",{className:l().modalHeader,children:[(0,s.jsx)("h2",{children:"Inventory"}),(0,s.jsx)("button",{className:l().closeBtn,onClick:a,children:"\xd7"})]}),(0,s.jsxs)("div",{className:l().inventorySection,children:[(0,s.jsx)("h3",{children:"Pickaxes"}),(0,s.jsx)("div",{className:l().pickaxeGrid,children:i.items.map(e=>(0,s.jsx)(k,{pickaxe:e,isSelected:e.id===u,onClick:v,showTooltip:!1},e.id))})]}),x&&(0,s.jsx)("div",{className:l().inventoryDetails,children:(0,s.jsxs)("div",{className:l().selectedItemDetails,children:[(0,s.jsxs)("h4",{children:[x.type," Pickaxe"]}),(0,s.jsxs)("p",{children:["Health: ",x.health," / ",x.getPickaxe().maxHealth]}),(0,s.jsxs)("p",{children:["Strength: ",x.getPickaxe().strength]}),u!==d&&(0,s.jsx)("button",{className:l().selectButton,onClick:()=>{u&&o&&(console.log("handlePickaxeSelect",u),o(u),a())},children:"Select Pickaxe"}),u===d&&(0,s.jsx)("div",{className:l().currentlyEquipped,children:"Currently Equipped"})]})})]})})},p=a(6335),j=a(7258),g=e=>{let{isOpen:t,onClose:a,blockName:c}=e;if(!t)return null;let n=new j.f({name:c,quantity:1});return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"".concat(l().blockDetailsOverlay),onClick:a}),(0,s.jsx)("div",{className:"".concat(l().blockDetailsDrawer," ").concat(t?l().open:""),children:(0,s.jsxs)("div",{className:l().blockDetailsContent,children:[(0,s.jsxs)("div",{className:l().blockDetailsHeader,children:[(0,s.jsx)("h2",{children:n.name}),(0,s.jsx)("button",{className:l().closeBtn,onClick:a,children:"\xd7"})]}),(0,s.jsxs)("div",{className:l().blockDetailsBody,children:[(0,s.jsx)("div",{className:l().blockDetailsImage,children:(0,s.jsx)("img",{src:n.getImageUrl(),alt:n.name})}),(0,s.jsxs)("div",{className:l().blockDetailsStat,children:[(0,s.jsx)("span",{className:l().statLabel,children:"Rarity:"}),(0,s.jsx)("span",{className:l().statValue,children:n.getBlock().rarity})]})]})]})})]})},b=e=>{let{isOpen:t,onClose:a,gameState:n,onUnlockBiome:o,onSelectBiome:r,selectionMode:i=!1}=e,m=p.a.items,u=n.unlockedBiomes,h=n.currentBiome.type,x=n.currentBiome.currentHealth<=0,k=(0,c.useRef)(null),[v,j]=(0,c.useState)(null);console.log("BiomesModal opened - Selection mode: ".concat(i,", Biome destroyed: ").concat(x,", Current health: ").concat(n.currentBiome.currentHealth)),(0,c.useEffect)(()=>{if(t&&k.current){let e=()=>{let e=k.current;e&&(e.scrollHeight>e.clientHeight?e.classList.add(l().hasScroll):e.classList.remove(l().hasScroll))};e();let t=new ResizeObserver(e);return t.observe(k.current),()=>{k.current&&t.unobserve(k.current),t.disconnect()}}},[t,m]);let b=e=>u.includes(e.toLowerCase()),N=e=>{o&&o(e.toLowerCase())},y=(e,t)=>{e.stopPropagation(),r&&b(t)&&t.toLowerCase()!==h&&(r(t.toLowerCase()),a())},C=e=>{if(b(e))return!0;let t=p.a.getItemByName(e);return!t.cost||n.blockInventory.hasBlock(t.cost.itemType,t.cost.amount)},f=(e,t)=>{e.stopPropagation(),j(t)};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"".concat(l().biomesOverlay," ").concat(t?l().biomesOverlayOpen:""),onClick:a}),(0,s.jsxs)("div",{className:"".concat(l().biomesDrawer," ").concat(t?l().biomesDrawerOpen:""),children:[(0,s.jsx)("div",{className:l().biomesDrawerHandle,onClick:a}),(0,s.jsx)("div",{className:l().biomesDrawerHeader,children:(0,s.jsx)("h2",{children:i?"Select Biome":"Available Biomes"})}),(0,s.jsx)("div",{ref:k,className:l().biomesDrawerContent,"data-drawer-type":"biomes",children:(0,s.jsx)("div",{className:l().biomesSection,children:(0,s.jsx)("div",{className:l().biomesGrid,children:m.map(e=>{let t=b(e.name),a=C(e.name),c=e.name.toLowerCase()===h;return(0,s.jsxs)("div",{className:"".concat(l().biomeItem," \n                                                ").concat(t?l().biomeUnlocked:l().biomeLocked,"\n                                                ").concat(c?l().biomeSelected:""),children:[(0,s.jsxs)("div",{className:l().biomeImageContainer,children:[(0,s.jsx)("img",{src:(0,d.K)("/assets/biomes/".concat(e.name.toLowerCase(),".png")),alt:e.name,className:l().biomeItemImg}),!t&&(0,s.jsx)("div",{className:l().lockOverlay,children:(0,s.jsx)("img",{src:(0,d.K)("/assets/padlock.svg"),alt:"Locked",className:l().lockIcon})}),(0,s.jsxs)("div",{className:l().biomeNameOverlay,children:[e.name,t&&(0,s.jsx)("span",{className:l().unlockedIndicator,children:"✓"}),c&&(0,s.jsx)("span",{className:l().currentIndicator,children:" (Current)"})]})]}),(0,s.jsxs)("div",{className:l().availableBlocks,children:[(0,s.jsx)("span",{children:"Available Blocks:"}),(0,s.jsx)("div",{className:l().blockImagesContainer,children:e.availableBlocks.map(e=>(0,s.jsxs)("div",{className:l().blockImageWrapper,onClick:t=>f(t,e),style:{cursor:"pointer"},children:[(0,s.jsx)("img",{src:(0,d.K)("/assets/blocks/".concat(e,".png")),alt:e,className:l().blockImage}),(0,s.jsx)("div",{className:l().blockName,children:e})]},e))})]}),(0,s.jsxs)("div",{className:l().availablePickaxes,children:[(0,s.jsx)("span",{children:"Available Pickaxes:"}),(0,s.jsx)("div",{className:l().blockImagesContainer,children:e.availablePickaxes.length>0?e.availablePickaxes.map(e=>(0,s.jsxs)("div",{className:l().blockImageWrapper,children:[(0,s.jsx)("img",{src:(0,d.K)("/assets/pickaxes/".concat(e,".png")),alt:e,className:l().blockImage}),(0,s.jsx)("div",{className:l().blockName,children:e})]},e)):(0,s.jsx)("div",{className:l().noPickaxes,children:"No pickaxes available"})})]}),(0,s.jsxs)("div",{className:l().itemInfo,children:[(0,s.jsx)("div",{className:l().itemDescription,children:e.description}),!t&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:l().unlockCost,children:e.cost?(0,s.jsxs)(s.Fragment,{children:["Cost:",(0,s.jsxs)("div",{className:l().costItemContainer,children:[(0,s.jsxs)("div",{className:l().costItemImgWrapper,children:[(0,s.jsx)("img",{src:(0,d.K)("/assets/blocks/".concat(e.cost.itemType,".png")),alt:e.cost.itemType,className:l().costItemImg}),(0,s.jsx)("span",{className:l().costItemBadge,children:e.cost.amount})]}),(0,s.jsx)("span",{className:a?l().affordableCost:l().unaffordableCost,children:e.cost.itemType.replace(/_/g," ")})]})]}):(0,s.jsx)("span",{className:l().affordableCost,children:"Free"})}),(0,s.jsx)("button",{className:"".concat(l().unlockButton," ").concat(a?"":l().unlockButtonDisabled),onClick:()=>N(e.name),disabled:!a,children:a?"Unlock":"Not enough resources"})]}),t&&i&&!c&&(0,s.jsx)("button",{className:l().selectButton,onClick:t=>y(t,e.name),children:"Select"}),t&&i&&c&&(0,s.jsx)("div",{className:l().currentlyEquipped,children:"Currently Selected"})]})]},e.name)})})})})]}),(0,s.jsx)(g,{isOpen:null!==v,onClose:()=>{j(null)},blockName:v||""})]})},N=e=>{let{block:t,className:a="",showTooltip:n=!0}=e,[o,r]=(0,c.useState)(!1),i=t.getBlock();return(0,s.jsxs)("div",{className:"".concat(l().inventorySlot," ").concat(a),title:"".concat(t.name," - Quantity: ").concat(t.quantity),onMouseEnter:()=>{r(!0)},onMouseLeave:()=>{r(!1)},children:[(0,s.jsx)("img",{src:t.getImageUrl(),alt:t.name,className:l().inventoryItem}),(0,s.jsx)("div",{className:l().itemCount,children:t.quantity}),n&&o&&(0,s.jsxs)("div",{className:l().quickItemTooltip,children:[(0,s.jsx)("div",{className:l().quickItemName,children:t.name.charAt(0).toUpperCase()+t.name.slice(1)}),(0,s.jsxs)("div",{className:l().quickItemStats,children:[(0,s.jsxs)("div",{children:["Quantity: ",t.quantity]}),(0,s.jsxs)("div",{children:["Rarity: ",i.rarity]})]})]})]})};function y(e){let{items:t,totalSlots:a,itemType:c,renderItem:n,renderEmptySlot:o}=e,r=[],i=t.length,d=Math.max(1,Math.ceil(i/a));for(let e=0;e<d;e++){let d=Array(a).fill(null);for(let s=0;s<a;s++){let c=e*a+s;c<i&&(d[s]=t[c])}r.push((0,s.jsx)("div",{className:l().quickInventory,children:d.map((t,a)=>t?n(t,e,a):o(e,a))},"".concat(c,"-row-").concat(e)))}return(0,s.jsx)(s.Fragment,{children:r})}var C=e=>{let{gameState:t,onSelectPickaxe:a}=e,c=t.pickaxeInventory,n=t.blockInventory,o=c.currentItem,r=e=>{a&&e&&a(e)};return(0,s.jsxs)("div",{className:l().quickInventoryContainer,children:[(0,s.jsxs)("div",{className:l().quickInventorySection,children:[(0,s.jsx)("div",{className:l().quickInventoryLabel,children:"Pickaxes"}),(0,s.jsx)(y,{items:c.items,totalSlots:8,itemType:"pickaxe",renderItem:(e,t,a)=>(0,s.jsx)(k,{pickaxe:e,isSelected:e.id===o,onClick:r},e.id),renderEmptySlot:(e,t)=>(0,s.jsx)("div",{className:l().inventorySlot},"pickaxe-empty-".concat(e,"-").concat(t))})]}),(0,s.jsxs)("div",{className:l().quickInventorySection,children:[(0,s.jsx)("div",{className:l().quickInventoryLabel,children:"Blocks"}),(0,s.jsx)(y,{items:n.items,totalSlots:8,itemType:"block",renderItem:(e,t,a)=>(0,s.jsx)(N,{block:e},"block-".concat(e.name,"-").concat(t,"-").concat(a)),renderEmptySlot:(e,t)=>(0,s.jsx)("div",{className:l().inventorySlot},"block-empty-".concat(e,"-").concat(t))})]})]})},f=a(7390),I=a(1499);class B{toggleSound(e){this.soundEnabled=e}preloadSound(e,t){try{let a=new Audio(t);this.sounds.set(e,a)}catch(t){console.error("Error loading sound ".concat(e,": ").concat(t))}}playSound(e){if(this.soundEnabled)try{let t=this.sounds.get(e);t?(t.currentTime=0,t.play().catch(t=>{console.error("Error playing sound ".concat(e,": ").concat(t))})):console.warn('Sound "'.concat(e,'" not found'))}catch(t){console.error("Error playing sound ".concat(e,": ").concat(t))}}constructor(){this.sounds=new Map,this.soundEnabled=!0,this.preloadSound("error","/assets/sounds/error.mp3")}}let S=new B;var w=a(224);let P=e=>{switch(e){case"Common":default:return 100;case"Uncommon":return 200;case"Rare":return 500;case"Legendary":return 2e3}},D=e=>{switch(e){case"Common":default:return"#aaaaaa";case"Uncommon":return"#55ff55";case"Rare":return"#5555ff";case"Legendary":return"#ffaa00"}};var T=e=>{let{isOpen:t,onClose:a,gameState:n,onBuyBlock:o}=e,r=n.currentBiome.getBiome(),i=r.availableBlocks||[],d=(0,c.useRef)(null),[m,u]=(0,c.useState)(null);(0,c.useEffect)(()=>{if(t&&d.current){let e=()=>{let e=d.current;e&&(e.scrollHeight>e.clientHeight?e.classList.add(l().hasScroll):e.classList.remove(l().hasScroll))};e();let t=new ResizeObserver(e);return t.observe(d.current),()=>{d.current&&t.unobserve(d.current),t.disconnect()}}},[t,i]);let h=e=>{u(e)};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"".concat(l().biomesOverlay," ").concat(t?l().biomesOverlayOpen:""),onClick:a}),(0,s.jsxs)("div",{className:"".concat(l().biomesDrawer," ").concat(t?l().biomesDrawerOpen:""),children:[(0,s.jsx)("div",{className:l().biomesDrawerHandle,onClick:a}),(0,s.jsx)("div",{className:l().biomesDrawerHeader,children:(0,s.jsxs)("h2",{children:["Buy Blocks from ",r.name," biome"]})}),(0,s.jsx)("div",{ref:d,className:l().biomesDrawerContent,"data-drawer-type":"blocks",children:(0,s.jsxs)("div",{className:l().biomesSection,children:[(0,s.jsxs)("p",{children:["Your picks: ",n.picks]}),0===i.length?(0,s.jsx)("p",{children:"No blocks available in this biome."}):(0,s.jsx)("div",{className:l().blocksGrid,children:i.map(e=>{let t=new j.f({name:e,quantity:1}),a=t.getImageUrl(),c=t.getBlock().rarity,i=P(c),d=n.picks>=i,m=D(c);return(0,s.jsxs)("div",{className:l().blockItem,onClick:()=>h(e),style:{cursor:"pointer"},children:[(0,s.jsxs)("div",{className:l().blockImageContainer,children:[(0,s.jsx)("img",{src:a,alt:e,className:l().blockItemImg}),(0,s.jsx)("div",{className:l().blockNameOverlay,children:e}),(0,s.jsx)("div",{className:l().rarityBadge,style:{backgroundColor:m},children:c})]}),(0,s.jsxs)("div",{className:l().blockItemContent,children:[(0,s.jsxs)("div",{className:l().blockDescription,children:["A ",c.toLowerCase()," ",e," block from the ",r.name," biome."]}),(0,s.jsx)("button",{className:"".concat(l().buyBlockButton," ").concat(d?"":l().buyBlockButtonDisabled),onClick:t=>{t.stopPropagation(),d&&o(e)},disabled:!d,children:d?"Buy (".concat(i," picks)"):"Need ".concat(i," picks")})]})]},e)})})]})})]}),(0,s.jsx)(g,{isOpen:null!==m,onClose:()=>{u(null)},blockName:m||""})]})},O=e=>{let{isOpen:t,onClose:a,gameState:n}=e,[o,r]=(0,c.useState)(!1);if(!t)return null;let i=f.ZP.exportGameState(n);return(0,s.jsx)("div",{className:l().modal+" "+l().modalShow,children:(0,s.jsxs)("div",{className:l().modalContent,children:[(0,s.jsxs)("div",{className:l().modalHeader,children:[(0,s.jsx)("h2",{children:"Export Game Save"}),(0,s.jsx)("button",{className:l().closeBtn,onClick:a,children:"\xd7"})]}),(0,s.jsxs)("div",{className:l().modalBody,children:[(0,s.jsx)("p",{children:"Copy the code below or download it as a file to save your current game progress:"}),(0,s.jsx)("div",{className:l().exportCodeContainer,children:(0,s.jsx)("textarea",{className:l().exportCode,value:i,readOnly:!0,rows:6})}),(0,s.jsxs)("div",{className:l().exportActions,children:[(0,s.jsx)("button",{className:l().exportActionButton,onClick:()=>{navigator.clipboard.writeText(i),r(!0),setTimeout(()=>r(!1),2e3)},children:o?"Copied!":"Copy to Clipboard"}),(0,s.jsx)("button",{className:l().exportActionButton,onClick:()=>{let e=document.createElement("a"),t=new Blob([i],{type:"text/plain"});e.href=URL.createObjectURL(t),e.download="mathcrafter-save-".concat(Date.now(),".txt"),document.body.appendChild(e),e.click(),document.body.removeChild(e)},children:"Download as File"})]})]})]})})},H=a(1517),L=()=>{let[e,t]=(0,c.useState)(!1),[a,n]=(0,c.useState)(f.ZP.loadGameState()),[m,k]=(0,c.useState)({num1:0,num2:0,operator:"+",answer:0}),[g,N]=(0,c.useState)(""),[y,B]=(0,c.useState)(!1),[P,D]=(0,c.useState)(!1),[L,E]=(0,c.useState)(!1),[M,q]=(0,c.useState)(!1),[R,U]=(0,c.useState)(!1),[A,F]=(0,c.useState)(!1),[G,K]=(0,c.useState)(""),[Z,z]=(0,c.useState)(!1),[_,Y]=(0,c.useState)(""),[Q,W]=(0,c.useState)(!1),[V,X]=(0,c.useState)(!1),[J,$]=(0,c.useState)(null),[ee,et]=(0,c.useState)(null),[ea,es]=(0,c.useState)(null),[ec,en]=(0,c.useState)(!1),[el,eo]=(0,c.useState)(!1),er=(0,c.useRef)(null);(0,c.useEffect)(()=>{t(!0),k(f.ZP.generateMathProblem()),n(f.ZP.loadGameState())},[]),(0,c.useEffect)(()=>{e&&!y&&f.ZP.saveGameState(a)},[a,e,y]),(0,c.useEffect)(()=>{console.log("gameState",a);let e=a.currentBiome;e.currentHealth<=0&&(console.log("Biome destroyed! Opening selection modal..."),Y(e.type),z(!0),setTimeout(()=>{z(!1)},3e3))},[a]),(0,c.useEffect)(()=>{R&&er.current&&setTimeout(()=>{var e;null===(e=er.current)||void 0===e||e.focus()},100)},[R]);let ei=()=>{k(f.ZP.generateMathProblem()),N("")},ed=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],s=a.pickaxeInventory.getCurrentItem();s&&($(e=e||s.getPicks()),setTimeout(()=>{$(null)},2e3)),em(),n(a=>{let s=a.pickaxeInventory.getCurrentItem();if(!s)return console.log("No current pickaxe found"),a;let c=a.increasePicks(e||0);if(t){let e=a.currentBiome.withDamage(s.getDamageToBiome(a.currentBiome.getBiome()));return console.log("Biome health: ".concat(e.currentHealth,"/").concat(e.getBiome().maxHealth)),c.withCurrentBiome(e)}return a})},em=()=>{if(!a.pickaxeInventory.getCurrentItem())return;let e=a.currentBiome;if(!e)return;let t=e.getBiome().availableBlocks,s={Common:[],Uncommon:[],Rare:[],Legendary:[]},c={Common:.55,Uncommon:.3,Rare:.1,Legendary:.05};t.forEach(e=>{let t=H.Z.getItemByName(e);if(null===t){console.error("Block with name ".concat(e," not found"));return}s[t.rarity].push(t)});let n=Object.keys(c).find(e=>Math.random()<=c[e]);if(!n){console.error("No rarity found");return}let l=Math.floor(Math.random()*s[n].length),o=s[n][l];if(!o){console.error("No block found");return}eu(o.name)},eu=e=>{let t=new j.f({name:e,quantity:1});et({name:e,imageUrl:t.getImageUrl()}),es(t),setTimeout(()=>{es(null)},3e3),n(t=>{let a=t.blockInventory.addBlock(e,1);return t.withBlockInventory(a)})},eh=()=>{W(!0),X(!0),S.playSound("error"),document.body.classList.add("screen-shake"),setTimeout(()=>{X(!1)},1e3),setTimeout(()=>{W(!1),document.body.classList.remove("screen-shake")},500),n(e=>{let t=e.pickaxeInventory.getCurrentItem();if(null===t)return e;let a=t.withDamage(1),s=new I.t({id:a.id,type:a.type,health:a.health});if(s.health<=0)return ex(e);let c=e.pickaxeInventory.withCurrentItem(s);return e.withPickaxeInventory(c)})},ex=e=>{let t=e.pickaxeInventory.getCurrentItem();if(!t)return e;if(K(t.type),F(!0),setTimeout(()=>{F(!1)},3e3),e.pickaxeInventory.length<=1)return B(!0),e;let a=e.pickaxeInventory.removeCurrentItem();return e.withPickaxeInventory(a)},ek=()=>{D(e=>!e)},ev=()=>{E(e=>!e)},ep=()=>{q(e=>!e)},ej=()=>{en(e=>!e)},eg=()=>{eo(e=>!e)},eb=e=>{if(!a.pickaxeInventory.items.find(t=>t.id===e)){console.error("Selected pickaxe not found in inventory");return}let t=a.pickaxeInventory.withCurrentItemId(e);n(e=>{let a=e.withPickaxeInventory(t);return setTimeout(()=>{f.ZP.saveGameState(a)},0),a}),E(!1)};return(a.pickaxeInventory.length,e)?(0,s.jsxs)("div",{className:l().gameContainer,children:[(0,s.jsxs)("div",{className:l().gameHeader,children:[(0,s.jsx)("h1",{children:"MathCrafter"}),(0,s.jsx)("div",{className:l().avatar,children:(0,s.jsx)("img",{src:(0,d.K)("/assets/avatars/avatar.png"),alt:"Player Avatar",className:l().avatarImage,onClick:ev,style:{cursor:"pointer"}})}),(0,s.jsx)("div",{className:l().stats,children:(0,s.jsxs)("div",{className:l().statItem,children:[(0,s.jsx)("img",{src:(0,d.K)("/assets/picks.png"),alt:"Picks",className:l().picksIcon}),(0,s.jsx)("span",{children:a.picks})]})}),(0,s.jsxs)("div",{className:l().headerButtons,children:[(0,s.jsx)("button",{className:l().pickaxesButton,onClick:ek,children:"Pickaxes"}),(0,s.jsx)("button",{className:l().unlockBiomesButton,onClick:ep,children:"Biomes"}),(0,s.jsx)("button",{className:l().buyBlocksButton,onClick:ej,children:"Blocks"}),(0,s.jsx)("button",{className:l().exportGameButton,onClick:eg,children:"Export"})]})]}),(0,s.jsxs)("div",{className:l().gameArea,children:[(0,s.jsx)(x,{onBiomeClick:()=>{if(R)return;let e=a.pickaxeInventory.getCurrentItem();e&&(Math.random()<=e.getPickaxe().critical?(U(!0),ei()):ed(e.getPickaxe().strength,!0))},currentPickaxe:a.pickaxeInventory.getCurrentItem(),currentBiome:a.currentBiome,picksToShow:J,minedBlock:ee}),(0,s.jsx)(C,{gameState:a,onSelectPickaxe:eb})]}),(0,s.jsx)("div",{className:"".concat(l().modal," ").concat(R?l().modalShow:""),children:(0,s.jsxs)("div",{className:"".concat(l().modalContent," ").concat(l().questionModalContent),children:[(0,s.jsxs)("div",{className:l().modalHeader,children:[(0,s.jsx)("h2",{children:"Math Problem"}),(0,s.jsx)("button",{className:l().closeBtn,onClick:()=>{U(!1)},children:"\xd7"})]}),(0,s.jsxs)("form",{className:"".concat(l().mathProblem," ").concat(Q?l().wrongAnswerShake+" "+l().wrongAnswerFlash:""),onSubmit:e=>{e.preventDefault();let t=parseInt(g);isNaN(t)||(t===m.answer?(ed(null,!0),ei(),N(""),U(!1)):(eh(),N("")))},children:[(0,s.jsxs)("div",{className:l().question,children:[m.num1," ",m.operator," ",m.num2," = ?"]}),(0,s.jsxs)("div",{className:l().answerArea,children:[(0,s.jsx)("input",{ref:er,type:"number",className:l().answer,value:g,onChange:e=>N(e.target.value),autoFocus:!0}),(0,s.jsx)("button",{type:"submit",className:l().submitBtn,children:"Mine!"})]}),(0,s.jsxs)("div",{className:l().numpad,children:[[7,8,9,4,5,6,1,2,3,0].map(e=>(0,s.jsx)("button",{type:"button",className:l().numpadBtn,onClick:()=>N(t=>t+e.toString()),children:e},e)),(0,s.jsx)("button",{type:"button",className:"".concat(l().numpadBtn," ").concat(l().clearBtn),onClick:()=>N(""),children:"Clear"}),(0,s.jsx)("button",{type:"button",className:"".concat(l().numpadBtn," ").concat(l().deleteBtn),onClick:()=>N(e=>e.slice(0,-1)),children:"←"})]})]})]})}),V&&(0,s.jsx)("div",{className:l().incorrectText,children:"INCORRECT!"}),(0,s.jsx)(u,{isOpen:P,onClose:ek,gameState:a,onBuyItem:(e,t)=>{let s=i.o.getItemByName(e);if(!s){console.error("Pickaxe with name ".concat(e," not found"));return}let c=s.cost.itemType,l=s.cost.amount;if(!a.blockInventory.hasBlock(c,l)){console.error("Not enough ".concat(c," to craft ").concat(e," pickaxe"));return}let o=new I.t({id:null,type:e,health:null}),r=a.blockInventory;r=r.addBlock(c,-l);let d=new w.C0({items:[...a.pickaxeInventory.items,o],currentItem:o.id});n(a.withPickaxeInventory(d).withBlockInventory(r))}}),(0,s.jsx)(v,{isOpen:L,onClose:ev,gameState:a,onSelectPickaxe:eb}),(0,s.jsx)(b,{isOpen:M,onClose:ep,gameState:a,onUnlockBiome:e=>{if(a.unlockedBiomes.includes(e))return;let t=p.a.getItemByName(e);if(!t){console.error("Biome with name ".concat(e," not found"));return}if(t.cost){let s=t.cost.itemType,c=t.cost.amount;if(!a.blockInventory.hasBlock(s,c)){console.error("Not enough ".concat(s," to unlock ").concat(e," biome"));return}n(t=>{let a=t.blockInventory;a=a.addBlock(s,-c);let n=[...t.unlockedBiomes,e];return new o.D({...t,unlockedBiomes:n,blockInventory:a})})}else n(t=>{let a=[...t.unlockedBiomes,e];return new o.D({...t,unlockedBiomes:a})})},onSelectBiome:e=>{n(t=>{let a=new r.k({id:null,type:e,currentHealth:null});return t.withCurrentBiome(a)})},selectionMode:!0}),(0,s.jsx)(T,{isOpen:ec,onClose:ej,gameState:a,onBuyBlock:e=>{a.picks<100||n(t=>{let a=t.increasePicks(-100),s=a.blockInventory.addBlock(e,1);return es(new j.f({name:e,quantity:1})),setTimeout(()=>{es(null)},3e3),a.withBlockInventory(s)})}}),(0,s.jsx)(O,{isOpen:el,onClose:eg,gameState:a}),(0,s.jsx)(h,{isOpen:y,onRestart:()=>{let e=f.ZP.loadGameState();n(e),B(!1),U(!1),ei(),f.ZP.saveGameState(e)}}),A&&(0,s.jsxs)("div",{className:l().brokenPickaxeNotification,children:[(0,s.jsx)("h3",{children:"Pickaxe Destroyed!"}),(0,s.jsxs)("p",{children:["Your ",G," Pickaxe has broken."]})]}),Z&&(0,s.jsxs)("div",{className:l().biomeDestroyedNotification,children:[(0,s.jsx)("h3",{children:"Biome Conquered!"}),(0,s.jsxs)("p",{children:["You've mined the ",_," biome."]}),(0,s.jsx)("p",{children:"Please select a new biome to explore!"})]}),ea&&(0,s.jsxs)("div",{className:l().blockAddedNotification,children:[(0,s.jsx)("img",{src:ea.getImageUrl(),alt:ea.name}),(0,s.jsx)("div",{children:(0,s.jsxs)("div",{children:["+1 ",ea.name]})})]})]}):(0,s.jsx)("div",{className:l().gameContainer,children:"Loading..."})}}}]);